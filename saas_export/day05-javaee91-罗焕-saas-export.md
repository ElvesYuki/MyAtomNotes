# 今日学习内容：

角色分配



### 1、角色分配：

**效果** ：进入用户角色分配界面，将用户角色数据返回显示；

​             勾选角色数据，分配角色数据，存入数据库

**步骤** ：

- 根据用户Id查询所有数据
- 查询所有角色数据
- 根据用户ID查询此用户所有角色数据
- 构造用户所有角色字符串，待会前端页面用contains方法循环展示
- 获取userId，roleId创建controller ，调用service，dao 先删除数据，在存入数据

**报错**：

报500错误，查看说明和日志。

**原因**：获取不到userId 

**解决办法**：原来是前端页面传递数据未满足小驼峰式，userid，

​	经改正为userId后正确运行。

### 2、用户登录：

longin.jsp页面，修改controller,获取password和eamil参数

判断email是否为空   为空则登录失败

获取password是否为空或password与数据中不同  空或不同则登录失败

else 登录成功

运用MD5加密；

### 3、动态构造菜单数据：



~~~
用户分类:
	1.saas管理员
	2.企业管理员
	3.企业的普通员工
菜单:
	1.saas管理的相关内部菜单
	2.企业相关的外部的业务菜单
动态菜单规则:
	1.saas管理员: 能够访问所有的saas内部的菜单
	2.企业管理员 :可以访问所有的企业相关的外部的业务菜单
	3.企业的普通员工:根据rbac的规则获取所有的企业菜单
~~~

用户数据

​	区分用户类型：通过degree的字段区分

​	degree = 0：saas管理员

​	degree = 1：企业管理员

​	degree = 其他：企业的普通员工

模块数据

​	区分菜单类型：通过belong字段区分

​	belong = 0：saas内部的菜单

​	belong = 1：企业的业务菜单

**效果**：不同角色的人登录显示菜单不同

**步骤**：页面处理

​	Controller：登录成功之后调用service查询

​	Service：根据用户等级不同进行不同查询

​	dao：根据belong查询模块

​			根据用户ID按照rbac的数据库关联查询所有模块

​	Mapper：写sql语句。

​		

